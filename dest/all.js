!function(t){"function"==typeof define&&define.amd?define(["snap","jquery"],t):s=t(Snap,$)}(function(t,e){function r(t,e,r){if(t.clear(),x?(t.unmousedown(),t.unmousemove(),t.unmouseup()):(t.untouchmove(),t.untouchstart(),t.untouchend()),"object"!=typeof e)return console.log("s:非法数据"),u(t,r);for(var n in e)return!0;return console.log("s:无数据"),u(t,r)}function n(t,n,i,a,o,f){function c(){return r(Y,n,f)?("function"!=typeof a&&(a=function(){}),_=2==i.length,j=_?n.k1.length>n.k2.length?n.k1:n.k2:n,I=j.length>1?($-q)/(j.length-1):$-q,void l()):!1}function l(){var r=0;return e.each(n,function(t,n){_?e.each(n,function(t,e){r=h(e.price,r)}):r=h(n.price,r)}),r?(P=d(r,G),chartSuccess(t,"line"),W(),z(),void p()):u(Y,f)}function h(t,e){var r=parseFloat(t);return r>e?r:e}function p(){x?(Y.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(Y.node).offset().left;m(r)}),e(Y.node).mouseleave(function(){k()})):(Y.touchstart(function(t){var e=t.touches[0].clientX;A=setTimeout(function(){m(e),Y.touchmove(function(t){t.preventDefault();var e=t.touches[0].clientX;m(e)})},100),Y.touchmove(function(t){clearTimeout(A)})}),Y.touchend(function(){Y.untouchmove(),k(),clearTimeout(A)}))}function m(t){var r=F(t),n=e(".svglinetip").attr("svglineid");n!=r&&(e(".svglinetip").remove(),e(".svglinemaker").hide(),b(r))}function k(){e(".svglinetip").remove(),e(".svglinemaker").show(),a()}function B(t,e,r){var n=t*I+q,i=X(e.price);if(!r)var a=Y.line(n,Z,n,O).attr({stroke:J?"#6ba8e1":"#d2d2d2",strokeWidth:2.5});var o=Y.circle(n,i,3).attr({stroke:J?"#fff":r?"#f5a25c":"#2484ce",strokeWidth:2,fill:J?"#47a8ef":"#fff"}),f=Y.paper.rect(n,r?O+1:H,100,O-H,4).attr({fill:J?"#fff":r?"#f5a25c":"#47a8ef"}),c=Y.paper.text(n,r?2*O-H-(O-H-14)/2:O-(O-H-14)/2,[e.name+":　","￥",g(e.price)+"　",e.num,"笔"]).attr({fill:J?"#2484ce":"#fff",fontSize:14});c.select("tspan:nth-child(2)").attr({fontSize:J?12:10}),c.select("tspan:nth-child(5)").attr({fontSize:J?12:10});var l=c.getBBox().width,s=l+20,u=n-s/2;0>u?u=0:u>E-s&&(u=E-s),f.attr({width:s,x:u}),c.attr({x:(s-l)/2+u});var h=Y.paper.g();r||h.add(a),h.add(o,f,c),h.attr("class","svglinetip"),h.attr("svglineid",t)}function S(t){void 0!=n.k1[t]&&B(t,n.k1[t]),void 0!=n.k2[t]&&B(t,n.k2[t],!0)}function b(t){_?(a([n.k1[t],n.k2[t]]),S(t)):(a(n[t]),B(t,n[t]))}function F(t){var r=t/e(Y.node).width()*E;q>=r&&(r=q),r>=$&&(r=$-1);var n=Math.floor((r-q)/I);return(r-q)%I>I/2&&1!=j.length&&n++,n}function z(){var t,e,r="M"+q+" "+Z,i="M"+q+" "+Z;if(_)t="M"+q+" "+X(n.k1[0].price),e="M"+q+" "+X(n.k2[0].price);else{var a=Y.circle(2,2,1.2).attr({stroke:J?"#ffffff":"#2484ce",strokeWidth:1,fill:J?"#2484ce":"#ffffff","class":"svglinemaker"}),o=a.marker(0,0,4,4,2,2);t="M"+q+" "+X(n[0].price),1==j.length&&(t+="L"+(I+q)+" "+X(n[0].price),r+="L"+(I+q)+" "+Z)}for(var f=1;f<j.length;f++)_?(void 0!=n.k1[f]&&(t+="L"+(I*f+q)+" "+X(n.k1[f].price),r+="L"+(I*f+q)+" "+Z),void 0!=n.k2[f]&&(e+="L"+(I*f+q)+" "+X(n.k2[f].price),i+="L"+(I*f+q)+" "+Z)):void 0!=n[f]&&(t+="L"+(I*f+q)+" "+X(n[f].price),r+="L"+(I*f+q)+" "+Z);T(r,t);var c=Y.path(r).attr({stroke:J?"#fffbcb":"#47a8ef",strokeWidth:2.5,fill:"none",strokeLinejoin:"bevel",markerEnd:o});if(_)var l=Y.path(i).attr({stroke:J?"#ffffff":"#f5a25c",strokeWidth:2.5,fill:"none",strokeLinejoin:"bevel"});var s=Y.g().attr({"class":"svglinemaker"});c.animate({path:t},800,mina.easeinout,function(){_||M(s)}),_&&l.animate({path:e},800,mina.easeinout)}function M(t){var e=n[n.length-1].price,r=parseFloat(n[n.length-1].price),i=r>P*G/1.3?24:-18,a=Y.rect(E,X(e)+i-13,0,17,10,10).attr({fill:J?"#ffffff":"#89c058"}),o=Y.text(E,X(e)+i,["￥",g(e)]).attr({fill:J?"#2f81d6":"#ffffff",fontSize:12});o.select("tspan").attr("font-size","11"),a.attr({x:$-o.getBBox().width-5,width:o.getBBox().width+10}),o.attr({x:$-o.getBBox().width}),t.add(a,o)}function T(t,e){var r=t+"V"+Z+"H"+q,n=e+"V"+Z+"H"+q,i=Y.path(r).attr({stroke:"none",fill:J?Y.paper.gradient("l(0, 0, 0,1 )#ffffff-#2884D3"):"#47a8ef",fillOpacity:J?"0.3":"0.1",strokeLinejoin:"bevel",strokeLinecap:"round"});i.animate({path:n},800,mina.easeinout)}function L(){for(var t=(Z-V)/G,e=Y.line(q,Z,$,Z).attr({stroke:J?"#519ddb":"#e2e2e2",strokeDasharray:"10 2",strokeWidth:.5}),r=1;G>=r;r++){var n=Z-r*t;e.clone().attr({x1:q,y1:n,x2:$,y2:n}),Y.text(q,n+13,g(P*r)).attr({fill:J?"#7abfe9":w,fontSize:10})}}function y(){var t=Y.paper.g().attr({fill:J?"#7abfe9":w,fontSize:10}),e=_?n.k1:n;if(!e.length)return console.log("s:k1无数据,画不出底部刻度"),!1;var r=e[0].name.indexOf("~")+1,i=D();if(0!=r&&i.length>4&&660>E){var a=Y.text(0,Z+12,e[0].name.substr(0,r)),o=Y.text(0,Z+22,e[0].name.substr(r)),f=Y.text(E,Z+12,e[e.length-1].name.substr(0,r)),c=Y.text(E,Z+22,e[e.length-1].name.substr(r));t.add(a,f,o,c),f.attr({x:E-f.getBBox().width}),c.attr({x:E-f.getBBox().width});for(var l=1;l<i.length-1;l++){var s=Y.text(I*i[l]+q,Z+12,e[i[l]].name.substr(0,r)),u=Y.text(I*i[l]+q,Z+22,e[i[l]].name.substr(r));s.attr({x:I*i[l]+q-s.getBBox().width/2}),u.attr({x:I*i[l]+q-s.getBBox().width/2}),t.add(s,u)}}else{var h=Y.text(0,Z+12,e[0].name),v=Y.text(E,Z+12,e[e.length-1].name);t.add(h,v),v.attr({x:E-v.getBBox().width});for(var d=1;d<i.length-1;d++){var p=Y.text(I*i[d]+q,Z+12,e[i[d]].name);p.attr({x:I*i[d]+q-p.getBBox().width/2}),t.add(p)}}}function W(){L(),y()}function D(){var t,e,r=[],n=j.length-1;if(n&&n-1)if(n%5)if(n%4)if(n%3)if((n-1)%5)if((n-1)%4)if((n-1)%3)if(n%2){if((n-1)%2)return console.log("s:均分日期未成功"),s(Y,"数据异常");e=2}else e=2;else e=3;else e=4;else e=5;else e=3;else e=4;else e=5;else e=1;t=Math.floor(n/e);for(var i=0;e>i;i++)r.push(t*i);var a=t*e;return n%e&&a++,r.push(a),r}function X(t){return t?(t=parseFloat(t),Z-t/(P*G)*(Z-V)):Z}var P,I,_,j,A,Y=Snap(t),E=v(o,"vw",e(t).width()),C=v(o,"vh",e(t).height()),H=v(o,"tt",0),O=v(o,"tb",30),V=v(o,"ct",2*(O-H)+H+10),Z=C-23,q=10,$=E-10,G=5,J=v(o,"isHome",!1);v(o,"isfull",!1);c()}function i(t,n,i,a,o,f){function c(){return r(E,n,f)?("function"!=typeof a&&(a=function(){}),I=2==i.length?!0:!1,_=void 0!=n[0].item?!0:!1,I||_||void 0==n[0].price&&(U=!0),P=I?37:26,void l()):!1}function l(){for(var e=0,r=0,i=0;i<n.length;i++){if(e>=100){n.splice(i,n.length-i);break}if(_){for(var a=0;a<n[i].item.length;a++){var o=n[i].item[a],f=s(o,r);if(f){if(r=f,84>C){var c=13*(o.name.toString().length+1)+6>84?84:13*(o.name.toString().length+1)+6;C=c>C?c:C}}else n[i].item.splice(a,1),a--;e++}n[i].item.length||(n.splice(i,1),i--)}else{U&&(n[i].price=n[i].num);var f=s(n[i],r);if(f){if(r=f,84>C){var c=13*n[i].name.toString().length+6>84?84:13*n[i].name.toString().length+6;C=c>C?c:C}}else n.splice(i,1),i--;e++}}return n.length?(X=d(r,K),chartSuccess(t,"bar"),z(),L(),void F()):(console.log("s:"+e+"条数据全是0"),u(E))}function s(t,e){var r;return I?0==parseFloat(t.k1.price)&&0==parseFloat(t.k2.price)?!1:(r=parseFloat(t.k1.price)>e?parseFloat(t.k1.price):e,r=parseFloat(t.k2.price)>r?parseFloat(t.k2.price):r):0==parseFloat(t.price)?!1:r=parseFloat(t.price)>e?parseFloat(t.price):e}function m(t,e,r){if(e){var n,a=t*P+P/2+q+N;n=I?parseFloat(e.price)>parseFloat(r.price)?y(e.price)+C+8:y(r.price)+C+8:y(e.price)+C+8;var o=E.line(n,a,n,Z).attr({stroke:"#d2d2d2",strokeWidth:2.5}),f=E.circle(n,a,3).attr({stroke:"#47a8ef",strokeWidth:3,fill:"#fff"}),c=E.paper.rect(n,V,100,Z-V,4).attr({fill:"#47a8ef"});if(U){var l=E.paper.text(n,Z-(Z-V-14)/2,[i[0]+":　",e.num+"次",""]).attr({fill:"#fff",fontSize:14});l.select("tspan:nth-child(3)").attr({fontSize:8})}else{var l=E.paper.text(n,Z-(Z-V-14)/2,[i[0]+":　","￥",g(e.price)+"　",e.num,"笔"]).attr({fill:"#fff",fontSize:14});l.select("tspan:nth-child(2)").attr({fontSize:8}),l.select("tspan:nth-child(5)").attr({fontSize:8})}var s=l.getBBox().width,u=s+20,h=n-u/2;0>h?h=0:h>H-u&&(h=H-u),c.attr({width:u,x:h}),l.attr({x:(u-s)/2+h});var v=E.paper.g();if(v.attr("class","svgbartip"),v.attr("svgbartipid",t),v.add(c,l,o,f),r){var d=E.paper.rect(n,Z+1,100,Z-V,4).attr({fill:"#f5a25c"}),p=E.paper.text(n,2*Z-V-(Z-V-14)/2,[i[1]+":　","￥",g(r.price)+"　",r.num,"笔"]).attr({fill:"#fff",fontSize:14});p.select("tspan:nth-child(2)").attr({fontSize:8}),p.select("tspan:nth-child(5)").attr({fontSize:8});var m=p.getBBox().width,x=m+20,k=n-x/2;0>k?k=0:k>H-x&&(k=H-x),d.attr({width:x,x:k}),p.attr({x:(x-m)/2+k}),v.add(d,p)}}else console.log("s:点击到了bar之外的区域")}function k(t){if(_){var e=p(t,n);I?m(t,n[e.parent].item[e.child].k1,n[e.parent].item[e.child].k2):m(t,n[e.parent].item[e.child]),a(n[e.parent].item[e.child]),R&&B(n[e.parent].item[e.child].name)}else I?m(t,n[t].k1,n[t].k2):m(t,n[t]),a(n[t]),R&&B(n[t].name)}function B(t){var e=E.text(0,V-8,t).attr({"class":"svgbartip",fill:"#1978bc",fontSize:18});e.attr("x",H/2-e.getBBox().width/2)}function S(){e(".svgbartip").remove(),a()}function b(t,e){Q=N+t-j,Q>0?Q=0:-P*(D+1)+($-q)>Q&&(Q=P*(D+1)>$-q?-P*(D+1)+($-q):0),A.transform("translate(0,"+Q+")")}function F(){x?(E.mousedown(function(t){j=t.clientY+e(document).scrollTop()-e(E.node).offset().top,j/=1.4,j>q&&$>j&&(Y=setTimeout(function(){var t=j-q-N,e=Math.floor(t/P);e>=0&&D>e&&k(e)},100),E.mousemove(function(t){var r=t.clientY+e(document).scrollTop()-e(E.node).offset().top;r/=1.4,r-j!=0&&(S(),clearTimeout(Y)),b(r,t)}))}),E.mouseup(function(t){E.unmousemove(),S(),clearTimeout(Y),N=Q}),e(t).mouseleave(function(){E.unmousemove()})):(E.touchstart(function(t){j=t.touches[0].clientY;var r=j+e(document).scrollTop()-E.node.offsetTop;r>q&&$>r&&(Y=setTimeout(function(){E.untouchmove();var t=r-q-N,n=Math.floor(t/P);n>=0&&D>n&&k(n),E.touchmove(function(t){t.preventDefault(),j=t.touches[0].clientY;var r=j+e(document).scrollTop()-E.node.offsetTop;if(r>q&&$>r){var n=r-q-N,i=Math.floor(n/P),a=e(".svgbartip").attr("svgbartipid");i>=0&&D>i&&a!=i&&(S(),k(i))}})},100),E.touchmove(function(t){if(clearTimeout(Y),R){t.preventDefault();var e=t.touches[0].clientY;b(e,t)}}))}),E.touchend(function(t){E.untouchmove(),S(),clearTimeout(Y),N=Q}))}function z(){for(var t=(J-C)/K,e=0;K>=e;e++){var r=C+e*t;E.line(r,$,r,q).attr({stroke:"#e2e2e2",strokeDasharray:"10 2",strokeWidth:.5});var n=E.text(r,O-4,g(X*e)).attr({fill:w,fontSize:10});n.attr("x",r-n.getBBox().width/2)}}function M(t,e,r){if(e){var n=W.text(C,I?D*P+24:D*P+16,_?h(e,5):h(e,6)).attr({fill:w,fontSize:12});n.attr("x",C-n.getBBox().width-4),A.add(n)}var i;i=r%2&&!_?"#88bf57":"#7cb7ef";var a=W.rect(C,e?D*P+8:D*P+P/2+1,y(t),10).attr({fill:e?i:"#f5a25c"});A.add(a)}function T(t,e){M(t.k1.price,t.name,e),M(t.k2.price,!1,e)}function L(){W=E.svg(0,q,H,$-q),A=W.g(),D=0;for(var t=0;t<n.length;t++){var r=n[t];if(_){var i=0;if(e.each(r.item,function(e,r){I?T(r,t):M(r.price,r.name,t),i++,D++}),i>1){var a=W.text(G,(D-i)*P+i*P/2+6,i>2?h(r.name,5):h(r.name,4)).attr({fill:w,fontSize:10});a.attr({x:G-a.getBBox().width/2}),a.transform("roate(-90)"),A.add(a)}var o=W.line(G,D*P,C-4,D*P).attr({stroke:w,strokeDasharray:"5 2",strokeWidth:1});A.add(o)}else I?T(r):M(r.price,r.name),D++}}function y(t){return t?parseFloat(t)/(K*X)*(J-C):0}var W,D,X,P,I,_,j,A,Y,E=Snap(t),C=0,H=v(o,"vw",e(t).width()),O=v(o,"vh",e(t).height()),V=v(o,"tt",0),Z=v(o,"tb",30),q=v(o,"ct",2*(Z-V)+V+10),$=O-18,G=10,J=H-20,K=400>H?5:6,N=0,Q=0,R=v(o,"isfull",!1),U=!1;c()}function a(t,n,i,a,o,f){function c(){return r(P,n,f)?("function"!=typeof a&&(a=function(){}),L=!0,y=!1,$=!0,T=26,void l()):!1}function l(){for(var e=0,r=0,i=0;i<n.length;i++){if(e>=100){n.splice(i,n.length-i);break}$&&(n[i].k1.price=n[i].k1.num,n[i].k2.price=n[i].k2.num);var a=s(n[i],r);if(a){if(r=a,84>I){var o=13*n[i].name.toString().length+6>84?84:13*n[i].name.toString().length+6;I=o>I?o:I}}else n.splice(i,1),i--;e++}return n.length?(M=d(r,O),chartSuccess(t,"bar"),k(),S(),void x()):(console.log("s:"+e+"条数据全是0"),u(P))}function s(t,e){var r;return L?0==parseFloat(t.k1.price)&&0==parseFloat(t.k2.price)?!1:(r=parseFloat(t.k1.price)>e?parseFloat(t.k1.price):e,r=parseFloat(t.k2.price)>r?parseFloat(t.k2.price):r):0==parseFloat(t.price)?!1:r=parseFloat(t.price)>e?parseFloat(t.price):e}function p(){e(".svgbartip").remove(),a()}function m(t,e){Z=V+t-W,Z>0?Z=0:-T*(z+1)+(C-E)>Z&&(Z=T*(z+1)>C-E?-T*(z+1)+(C-E):0),D.transform("translate(0,"+Z+")")}function x(){P.touchstart(function(t){W=t.touches[0].clientY;var r=W+e(document).scrollTop()-P.node.offsetTop;r>E&&C>r&&P.touchmove(function(t){if(clearTimeout(X),q){t.preventDefault();var e=t.touches[0].clientY;m(e,t)}})}),P.touchend(function(t){P.untouchmove(),p(),clearTimeout(X),V=Z})}function k(){for(var t=(H-I)/O,e=0;O>=e;e++){var r=I+e*t;P.line(r,C,r,E).attr({stroke:"#e2e2e2",strokeDasharray:"10 2",strokeWidth:.5});var n=P.text(r,j-4,g(M*e)).attr({fill:w,fontSize:10});n.attr("x",r-n.getBBox().width/2)}}function B(t,e,r){var n=F.text(I,z*T+14,y?h(r,5):h(r,6)).attr({fill:w,fontSize:12});n.attr("x",I-n.getBBox().width-4),D.add(n);var i=F.text(I+b(t),z*T+14,"　("+t+"/"+e+")").attr({fill:w,fontSize:12});D.add(i);var a=F.rect(I,z*T+5,b(t),10).attr({fill:"#d9d9d9"});D.add(a);var o=F.rect(I,z*T+5,b(e),10).attr({fill:"#88bf57"});D.add(o)}function S(){F=P.svg(0,E,_,C-E),D=F.g(),z=0;for(var t=0;t<n.length;t++){var e=n[t];B(e.k1.price,e.k2.price,e.name),z++}}function b(t){return t?parseFloat(t)/(O*M)*(H-I):0}var F,z,M,T,L,y,W,D,X,P=Snap(t),I=0,_=v(o,"vw",e(t).width()),j=v(o,"vh",e(t).height()),A=v(o,"tt",0),Y=v(o,"tb",30),E=v(o,"ct",2*(Y-A)+A+10),C=j-18,H=_-20,O=400>_?5:6,V=0,Z=0,q=v(o,"isfull",!1),$=!1;c()}function o(t,n,i,a,o,f){function c(){return r(H,n,f)?("function"!=typeof a&&(a=function(){}),Y=2==i.length?!0:!1,E=void 0!=n[0].item?!0:!1,_=Y?53:42,P=E?V-37:V-25,void l()):!1}function l(){for(var e=0,r=0,i=0;i<n.length;i++){if(e>=100){n.splice(i,n.length-i);break}if(E){for(var a=0;a<n[i].item.length;a++){var o=n[i].item[a],c=s(o,r);c?r=c:(n[i].item.splice(a,1),a--),e++}n[i].item.length||(n.splice(i,1),i--)}else{var c=s(n[i],r);c?r=c:(n.splice(i,1),i--),e++}}return n.length?(I=d(r,K),chartSuccess(t,"column"),z(),y(),void F()):(console.log("s:"+e+"条数据price全是0"),u(H,f))}function s(t,e){var r;return Y?0==parseFloat(t.k1.price)&&0==parseFloat(t.k2.price)?!1:(r=parseFloat(t.k1.price)>e?parseFloat(t.k1.price):e,r=parseFloat(t.k2.price)>r?parseFloat(t.k2.price):r):0==parseFloat(t.price)?!1:r=parseFloat(t.price)>e?parseFloat(t.price):e}function m(t,e,r){if(e){var n,a=t*_+_/2+D+N;n=Y?parseFloat(e.price)>parseFloat(r.price)?M(e.price)+$-8:M(r.price)+$-8:M(e.price)+$-8;var o=H.line(a,n,a,q).attr({stroke:"#d2d2d2",strokeWidth:2.5}),f=H.circle(a,n,3).attr({stroke:"#47a8ef",strokeWidth:3,fill:"#fff"}),c=H.paper.rect(a,Z,100,q-Z,4).attr({fill:"#47a8ef"}),l=H.paper.text(a,q-(q-Z-14)/2,[i[0]+":　","￥",g(e.price)+"　",e.num,"笔"]).attr({fill:"#fff",fontSize:14});l.select("tspan:nth-child(2)").attr({fontSize:8}),l.select("tspan:nth-child(5)").attr({fontSize:8});var s=l.getBBox().width,u=s+20,h=a-u/2;0>h?h=0:h>O-u&&(h=O-u),c.attr({width:u,x:h}),l.attr({x:(u-s)/2+h});var v=H.paper.g();if(v.attr("class","svgcolumntip"),v.attr("svgcolumntipid",t),v.add(c,l,o,f),r){var d=H.paper.rect(a,q+1,100,q-Z,4).attr({fill:"#f5a25c"}),p=H.paper.text(a,2*q-Z-(q-Z-14)/2,[i[1]+":　","￥",g(r.price)+"　",r.num,"笔"]).attr({fill:"#fff",fontSize:14});p.select("tspan:nth-child(2)").attr({fontSize:8}),p.select("tspan:nth-child(5)").attr({fontSize:8});var m=p.getBBox().width,x=m+20,k=a-x/2;0>k?k=0:k>O-x&&(k=O-x),d.attr({width:x,x:k}),p.attr({x:(x-m)/2+k}),v.add(d,p)}}else console.log("点击到了bar之外的区域")}function k(t){if(E){var e=p(t,n);e&&(Y?m(t,n[e.parent].item[e.child].k1,n[e.parent].item[e.child].k2):m(t,n[e.parent].item[e.child]),a(n[e.parent].item[e.child]),R&&S(n[e.parent].item[e.child].name))}else Y?m(t,n[t].k1,n[t].k2):m(t,n[t]),a(n[t]),R&&S(n[t].name)}function B(){e(".svgcolumntip").remove(),a()}function S(t){var e=H.text(0,Z-8,t).attr({"class":"svgcolumntip",fill:"#1978bc",fontSize:18});e.attr("x",O/2-e.getBBox().width/2)}function b(t,e){Q=N+t-j,Q>0?Q=0:-_*(X+1)+O-D>Q&&(Q=_*(X+1)>O-D?-_*(X+1)+O-D:0),A.transform("translate("+Q+",0)")}function F(){x?(H.mousedown(function(t){H.unmousemove(),j=t.clientX+e(document).scrollLeft()-e(H.node).offset().left,j=j/e(H.node).width()*O,H.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(H.node).offset().left;r=r/e(H.node).width()*O,r-j!=0&&(B(),clearTimeout(C)),b(r,t)}),H.mouseup(function(t){H.unmousemove(),H.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(H.node).offset().left;r=r/e(H.node).width()*O,r=r-D-N;var n=Math.floor(r/_),i=e(".svgcolumntip").attr("svgcolumntipid");n>=0&&X>n&&i!=n&&(B(),k(n))}),N=Q})}),H.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(H.node).offset().left;r=r/e(H.node).width()*O,r=r-D-N;var n=Math.floor(r/_),i=e(".svgcolumntip").attr("svgcolumntipid");n>=0&&X>n&&i!=n&&(B(),k(n))}),e(t).mouseleave(function(){B()})):(H.touchstart(function(t){j=t.touches[0].clientX,R&&(j=j/e(H.node).width()*O),C=setTimeout(function(){H.untouchmove();var t=j-D-N,r=Math.floor(t/_);r>=0&&X>r&&k(r),H.touchmove(function(t){t.preventDefault(),j=t.touches[0].clientX,R&&(j=j/e(H.node).width()*O);var r=j-D-N,n=Math.floor(r/_),i=e(".svgcolumntip").attr("svgcolumntipid");n>=0&&X>n&&i!=n&&(B(),k(n))})},100),H.touchmove(function(t){if(clearTimeout(C),R){var r=t.touches[0].clientX;t.preventDefault(),r=r/e(H.node).width()*O,b(r,t)}})}),H.touchend(function(t){H.untouchmove(),B(),clearTimeout(C),N=Q}))}function z(){D=0;for(var t=(P-$)/K,e=H.line(G,P,J,P).attr({stroke:"#e2e2e2",strokeDasharray:"10 2",strokeWidth:.5}),r=1;K>=r;r++){var n=P-r*t;e.clone().attr({x1:G,y1:n,x2:J,y2:n});var i=H.text(G,n+15,g(I*r)).attr({fill:w,fontSize:12});D=i.getBBox().width+G+10>D?i.getBBox().width+G+10:D}}function M(t){return t||(t=0),t=parseFloat(t),P-$-t/(I*K)*(P-$)}function T(t,e){var r=_*X,n=M(t),i=W.rect(e?r+16:r+28,n,10,P-$-n).attr({fill:e?"#7cb7ef":"#f5a25c"});if(A.add(i),e){e=e.toString();var a=Y?8:6;if(e.length>a&&(e=h(e,a)),e.length>a/2){var o=e.substr(0,a/2),f=e.substr(a/2),c=W.text(r,P-$+11,o).attr({fill:w,fontSize:10}),l=W.text(r,P-$+22,f).attr({fill:w,fontSize:10});c.attr("x",r+(_-c.getBBox().width)/2),l.attr("x",r+(_-c.getBBox().width)/2),A.add(c,l)}else{var s=W.text(r,P-$+11,e).attr({fill:w,fontSize:10});s.attr("x",r+(_-s.getBBox().width)/2),A.add(s)}}}function L(t,e){T(t.k1.price,t.name,e),T(t.k2.price,!1,e)}function y(){W=H.svg(D,$,O-D,V-$),A=W.g(),X=0;for(var t=0;t<n.length;t++)if(E){var r=0;if(e.each(n[t].item,function(e,n){Y?L(n,t):T(n.price,n.name,t),X++,r++}),r>1){var i=W.text(X*_,V-$-2,h(n[t].name,6)).attr({fill:w,fontSize:10});i.attr({x:(X-r)*_+(r*_-i.getBBox().width)/2}),A.add(i)}var a=W.line(X*_,P-$+2,X*_,V-$-1).attr({stroke:w,strokeDasharray:"5 2",strokeWidth:1});A.add(a)}else Y?L(n[t]):T(n[t].price,n[t].name),X++}var W,D,X,P,I,_,j,A,Y,E,C,H=Snap(t),O=v(o,"vw",e(t).width()),V=v(o,"vh",e(t).height()),Z=v(o,"tt",0),q=v(o,"tb",30),$=v(o,"ct",2*(q-Z)+Z+10),G=10,J=O,K=5,N=0,Q=0,R=v(o,"isfull",!1);c()}function f(t,n,i,a,o,f){function c(){return r(b,n,f)?("function"!=typeof a&&(a=function(){}),void s()):!1}function l(){x?b.mousedown(function(){e(".svgpiepie").attr("transform",""),S(),a()}):b.touchstart(function(){e(".svgpiepie").attr("transform",""),S(),a()})}function s(){var e={};e.price=0,e.time=0,e.num=0,e._num=0;for(var r=n[0].price,i=0;i<n.length;i++){void 0!=r?n[i]._num=n[i].price:n[i]._num=n[i].num;var a=parseFloat(n[i]._num);if(_){var o=n[i].name.toString();o.length>5&&(j=2)}if(!a){if(0==i)return console.log("s:第一个数据数值为0"),u(b,f);n.splice(i,n.length-i);break}I+=a,i+1>8&&(e._num+=a,e.name="其他",e.num+=parseFloat(n[i].num))}e.name&&(e._num+=parseFloat(n[7]._num),e.num+=parseFloat(n[7].num),e.price+=parseFloat(n[7].price),e.time+=parseFloat(n[7].time),n.splice(7,n.length-7,e)),chartSuccess(t,"pie"),n[0]._num==I?m():d(),l()}function d(){var t=0,r=[],i=[];r[0]=W-D,i[0]=X,e.each(n,function(e,n){var a=n._num/I,o=a>.5?1:0;t+=a,r[e+1]=W-D*Math.cos(2*Math.PI*t),i[e+1]=X-D*Math.sin(2*Math.PI*t);var f=t-a/2,c=W-10*Math.cos(2*Math.PI*f)-W,l=X-10*Math.sin(2*Math.PI*f)-X,s="M "+W+" "+X+"L "+r[e]+" "+i[e]+" A "+D+" "+D+" 0 "+o+" 1 "+r[e+1]+" "+i[e+1]+"  Z",u=b.g().attr({"class":"svgpiepie"}),h=Math.floor(Math.random()*P.length),v=b.path(s).attr({fill:P[h],stroke:"#fff",strokeWidth:"1"});if(u.add(v),a>1/14){var d=W-D*Math.cos(2*Math.PI*f)/1.4-18,m=X-D*Math.sin(2*Math.PI*f)/1.4,g=b.text(d,m,Math.round(1e3*n._num/I)/10+"%").attr({fill:"#fff",fontSize:12});u.add(g)}x?u.mousedown(function(t){k(this,c,l,n,t)}):u.touchstart(function(t){k(this,c,l,n,t)}),p(P[h],e,n,u,c,l),P.splice(h,1)})}function p(t,e,r,n,i,a){if(_)var o=Math.floor(e/j),f=e%j,c=b.rect(F/10+f*(.8*F)/j,y+30+30*o,5,5).attr({fill:t}),l=b.text(F/10+f*(.8*F)/j+10,y+38+30*o,h(r.name,3==j?5:8)).attr({fontSize:14});else var s=L+e*(y-L)/8+9,c=b.rect(2*F/3,s,5,5).attr({fill:t}),l=b.text(2*F/3+10,s+7,x?r.name:h(r.name,6)).attr({fontSize:14});var u=b.g();u.add(c,l),x?u.mousedown(function(t){k(n,i,a,r,t)}):u.touchstart(function(t){k(n,i,a,r,t)})}function m(){var t=Math.floor(8*Math.random()),e=b.circle(W,X,D).attr({fill:P[t]});x?e.mousedown(function(r){r.stopPropagation(),e.attr("hasTip","1"),B(P[t],n[0]),a(n[0])}).mouseup(function(){e.attr("hasTip","0"),S(),a()}):e.touchstart(function(r){r.stopPropagation(),e.attr("hasTip","1"),B(P[t],n[0]),_&&w(n[0].name),a(n[0])}).touchend(function(){e.attr("hasTip","0"),S(),a()}),b.text(W-12,X,"100%").attr({fill:"#fff",fontSize:12}),p(P[t],0,n[0],e)}function k(t,r,n,i,o){if(r){if(!t.transform().string){var f=t.select("path").attr("fill");o.stopPropagation(),x?(e(".svgpiepie").removeAttr("transform"),e(t.node).attr({transform:"translate("+r+","+n+")"})):(e(".svgpiepie").attr("transform",""),t.animate({transform:"translate("+r+","+n+")"},300,mina.easein)),B(f,i),_&&w(i.name),a(i)}}else{var f=t.attr("fill");1==t.attr("hasTip")?t.attr({hasTip:"0"}):(o.stopPropagation(),t.attr({hasTip:"1"}),B(f,i),_&&w(i.name),a(i))}}function w(t){var e=b.text(0,M-17,t).attr({"class":"svgpietip",fill:"#1978bc",fontSize:18});e.attr("x",F/2-e.getBBox().width/2)}function B(t,r){e(".svgpietip").remove();var a=b.rect(F/2,M,0,T-M,3).attr({fill:t,"class":"svgpietip"});if("undefined"==typeof n[0].time)var o=b.text(F/2,T-(T-M-10)/2,[i[0]+":　","￥",g(r.price)+"　",r.num,"笔"]).attr({fill:"#fff","class":"svgpietip",fontSize:14});else var o=b.text(F/2,T-(T-M-10)/2,[i[0]+":　",r.time,"个客户"]).attr({fill:"#fff","class":"svgpietip",fontSize:14});a.attr({width:o.getBBox().width+20,x:F/2-(o.getBBox().width+20)/2}),o.attr({x:F/2-o.getBBox().width/2})}function S(){e(".svgpietip").remove()}var b=Snap(t),F=v(o,"vw",e(t).width()),z=v(o,"vh",e(t).height()),M=v(o,"tt",0),T=v(o,"tb",35),L=v(o,"ct",T+30),y=v(o,"cb",z-10),W=v(o,"px",F/3),D=.8*W>(y-L)/2?(y-L)/2:.8*W,X=L+D,P=["#F27254","#FFBE32","#A1BB38","#5BC45E","#51B4D4","#576ACD","#A66CE2","#FF74E0"],I=0,_=v(o,"isfull",!1),j=3;c()}function c(t,n){function i(){return"undefined"==typeof nodataStr&&(nodataStr=""),r(f,n,nodataStr)?void a():!1}function a(){var t,e;if(2!=n.length)s(f,"数据错误");else{var r=parseInt(n[0])+parseInt(n[1]);0==r?(t=.5,e=.5):(t=parseInt(n[0])/r,e=parseInt(n[1])/r)}o(t,e)}function o(t,r){var n=0,i=[],a=[];i[0]=u,a[0]=h-v,e.each([t,r],function(t,e){1==e&&(e=.9999);var r=e>.5?1:0;n+=e,i[t+1]=u+v*Math.sin(2*Math.PI*n),a[t+1]=h-v*Math.cos(2*Math.PI*n);var o="M "+u+" "+h+"L "+i[t]+" "+a[t]+" A "+v+" "+v+" 0 "+r+" 1 "+i[t+1]+" "+a[t+1]+"  Z";f.path(o).attr({fill:d[t]})}),f.circle(u,h,3*v/4).attr({fill:"#ffffff"})}var f=Snap(t),c=e(t).width(),l=e(t).height(),u=c/2,h=l/2,v=u>h?h:u,d=["#7ad169","#e5e5e5"];i()}function l(t,n,i,a,o,f){function c(){return r(A,n,f)?("function"!=typeof a&&(a=function(){}),void l()):!1}function l(){var e=0,r=0;void 0!=n.avg?(j=n.avg,n=n.item):j=!1;for(var i=0;i<n.length;i++){if(e>=100){n.splice(i,n.length-i);break}var a=s(n[i],r);a?r=a:(n.splice(i,1),i--),e++}return n.length?(X=d(r,G),chartSuccess(t,"column"),F(),L(),T(),void b()):(console.log("s:"+e+"条数据num全是0"),u(A,f))}function s(t,e){var r;return 0==parseFloat(t.num)?!1:r=parseFloat(t.num)>e?parseFloat(t.num):e}function p(t,e){if(e){var r=t*$+$/2+W+J,n=z(e.num)+O-8,a=A.line(r,n,r,H).attr({stroke:"#d2d2d2",strokeWidth:2.5}),o=A.circle(r,n,3).attr({stroke:"#47a8ef",strokeWidth:3,fill:"#fff"}),f=A.paper.rect(r,C,100,H-C,4).attr({fill:"#47a8ef"});if(j)var c=[i[0]+":　",e.num+"次"];else var c=[i[0]+":　",e.num+"次　人均:　",e.avg,"次"];var l=A.paper.text(r,H-(H-C-14)/2,c).attr({fill:"#fff",fontSize:14}),s=l.getBBox().width,u=s+20,h=r-u/2;0>h?h=0:h>Y-u&&(h=Y-u),f.attr({width:u,x:h}),l.attr({x:(u-s)/2+h});var v=A.paper.g();v.attr("class","svgcolumntip"),v.attr("svgcolumntipid",t),v.add(f,l,a,o)}else console.log("点击到了bar之外的区域")}function m(t){p(t,n[t]),a(n[t]),N&&B(n[t].name)}function k(){e(".svgcolumntip").remove(),a()}function B(t){var e=A.text(0,C-8,t).attr({"class":"svgcolumntip",fill:"#1978bc",fontSize:18});e.attr("x",Y/2-e.getBBox().width/2)}function S(t,e){K=J+t-P,K>0?K=0:-$*(D+1)+Y-W>K&&(K=$*(D+1)>Y-W?-$*(D+1)+Y-W:0),I.transform("translate("+K+",0)")}function b(){x?(A.mousedown(function(t){A.unmousemove(),P=t.clientX+e(document).scrollLeft()-e(A.node).offset().left,P=P/e(A.node).width()*Y,A.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(A.node).offset().left;r=r/e(A.node).width()*Y,r-P!=0&&(k(),clearTimeout(_)),S(r,t)}),A.mouseup(function(t){A.unmousemove(),A.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(A.node).offset().left;r=r/e(A.node).width()*Y,r=r-W-J;var n=Math.floor(r/$),i=e(".svgcolumntip").attr("svgcolumntipid");n>=0&&D>n&&i!=n&&(k(),m(n))}),J=K})}),A.mousemove(function(t){var r=t.clientX+e(document).scrollLeft()-e(A.node).offset().left;r=r/e(A.node).width()*Y,r=r-W-J;var n=Math.floor(r/$),i=e(".svgcolumntip").attr("svgcolumntipid");n>=0&&D>n&&i!=n&&(k(),m(n))}),e(t).mouseleave(function(){k()})):(A.touchstart(function(t){P=t.touches[0].clientX,N&&(P=P/e(A.node).width()*Y),_=setTimeout(function(){A.untouchmove();var t=P-W-J,r=Math.floor(t/$);r>=0&&D>r&&m(r),A.touchmove(function(t){t.preventDefault(),P=t.touches[0].clientX,N&&(P=P/e(A.node).width()*Y);var r=P-W-J,n=Math.floor(r/$),i=e(".svgcolumntip").attr("svgcolumntipid");n>=0&&D>n&&i!=n&&(k(),m(n))})},100),A.touchmove(function(t){if(clearTimeout(_),N){var r=t.touches[0].clientX;t.preventDefault(),r=r/e(A.node).width()*Y,S(r,t)}})}),A.touchend(function(t){A.untouchmove(),k(),clearTimeout(_),J=K}))}function F(){W=0;for(var t=(V-O)/G,e=A.line(Z,V,q,V).attr({stroke:"#e2e2e2",strokeDasharray:"10 2",strokeWidth:.5}),r=1;G>=r;r++){var n=V-r*t;e.clone().attr({x1:Z,y1:n,x2:q,y2:n});var i=A.text(Z,n+15,g(X*r)).attr({fill:w,fontSize:12});W=i.getBBox().width+Z+10>W?i.getBBox().width+Z+10:W}}function z(t){return t||(t=0),t=parseFloat(t),V-O-t/(X*G)*(V-O)}function M(t,e){var r=$*D,n=z(t),i=y.rect(e?r+16:r+28,n,10,V-O-n).attr({fill:e?"#7cb7ef":"#f5a25c"});I.add(i),e=e.toString();var a=6;if(e.length>a&&(e=h(e,a)),e.length>a/2){var o=e.substr(0,a/2),f=e.substr(a/2),c=y.text(r,V-O+11,o).attr({fill:w,fontSize:10}),l=y.text(r,V-O+22,f).attr({fill:w,fontSize:10});c.attr("x",r+($-c.getBBox().width)/2),l.attr("x",r+($-c.getBBox().width)/2),I.add(c,l)}else{var s=y.text(r,V-O+11,e).attr({fill:w,fontSize:10});s.attr("x",r+($-s.getBBox().width)/2),I.add(s)}}function T(){if(j){var t=A.circle(2,2,1.2).attr({stroke:"#f5a25c",strokeWidth:1,fill:"#ffffff"}),e=t.marker(0,0,4,4,2,2),r="M"+(W+$/5)+" "+(z(j)+O)+"L"+(q-$/5-5)+" "+(z(j)+O);A.path(r).attr({stroke:"#f5a25c",strokeWidth:2.5,fill:"none",strokeLinejoin:"bevel",markerEnd:e});var i=A.rect(Y,z(j)+O-20-13,0,17,10,10).attr({fill:"#f5a25c"}),a=A.text(Y,z(j)+O-20,"人均"+j+"次").attr({fill:"#ffffff",fontSize:12});i.attr({x:q-a.getBBox().width-15,width:a.getBBox().width+10}),a.attr({x:q-a.getBBox().width-10})}else{for(var r="M"+$/2+" "+z(n[0].avg),o=1;o<n.length;o++)void 0!=n[o]&&(r+="L"+($*o+$/2)+" "+z(n[o].avg));if(1==n.length){var f=y.circle($/2,z(n[0].avg),4).attr({stroke:"#f5a25c",strokeWidth:2,fill:"#ffffff"});I.add(f)}else{var c=y.path(r).attr({stroke:"#f5a25c",strokeWidth:2.5,fill:"none",strokeLinejoin:"bevel"});I.add(c)}}}function L(){y=A.svg(W,O,Y-W,E-O),I=y.g(),D=0;for(var t=0;t<n.length;t++)M(n[t].num,n[t].name),D++}var y,W,D,X,P,I,_,j,A=Snap(t),Y=v(o,"vw",e(t).width()),E=v(o,"vh",e(t).height()),C=v(o,"tt",0),H=v(o,"tb",30),O=v(o,"ct",2*(H-C)+C+10),V=E-25,Z=10,q=Y,$=42,G=5,J=0,K=0,N=v(o,"isfull",!1);c()}function s(t,r){var n=t.text(e(t.node).width()/2,e(t.node).height()/2+20,r).attr({fontSize:24});return n.attr({x:e(t.node).width()/2-n.getBBox().width/2}),!1}function u(t,r){var n,i;t.attr("viewBox")?(n=t.attr("viewBox").width,i=t.attr("viewBox").height):(n=e(t.node).width(),i=e(t.node).height());var a=t.paper.image(svgnodataurl,10,10,168,90);a.attr({x:n/2-a.getBBox().width/2,y:i/2-a.getBBox().height/2});var o="暂无经营数据",f="赶快使用订单系统，公司经营各项数据轻松在手！";r&&(o=r.split("|")[0],f=r.split("|")[1]);var c=t.text(n/2,a.getBBox().y2+24,o).attr({fontSize:16,fill:k?"#67b7ed":"#bbbbbb"}),l=t.text(n/2,a.getBBox().y2+46,f).attr({fontSize:14,fill:k?"#67b7ed":"#bbbbbb"});return c.attr({x:n/2-c.getBBox().width/2}),l.attr({x:n/2-l.getBBox().width/2}),!1}function h(t,e){return t.substr(0,e)}function v(t,e,r){return t&&void 0!=t[e]?t[e]:r}function d(t,e){if(0==t)return 1;var r,n=t/e;return r=n>1e4?5e3:n>5e3?1e3:n>2e3?500:n>500?100:n>100?20:n>e?10:1,Math.ceil(n/r)*r}function p(t,e){for(var r=0,n=0,i=0,a=0;a<e.length;a++){if(t<e[a].item.length+i)return r=a,n=t-i,{parent:r,child:n};i=e[a].item.length+i}return!1}function m(t){var e;return t>=1e5?t>=1e8?t>=1e10?(e=Math.round(t/1e8),[e.toString(),"亿"]):(e=Math.round(t/1e7),[e.toString().slice(0,-1),"亿",e.toString().slice(-1)]):t>=1e6?(e=Math.round(t/1e4),[e.toString(),"万"]):(e=Math.round(t/1e3),[e.toString().slice(0,-1),"万",e.toString().slice(-1)]):[t.toString()]}function g(t){var e,r=m(parseInt(t));if(r[0].length>3)for(var n=3;n<r[0].length;n+=4)e=r[0].slice(0,-n)+","+r[0].slice(-n);else e=r[0];return r[2]&&(e+="."+r[2]),r[1]&&(e+=r[1]),e}var x=!1,k=!1,w="#b0b0b0";return{drawBar:i,drawLine:n,drawColumn:o,drawPie:f,drawLoop:c,drawMixAvg:l,drawProgress:a}});