var s={isPc:false,isHome:false,fontColor:"#b0b0b0",_init:function(a,c){a.clear();if(s.isPc){a.unmousedown();a.unmousemove();a.unmouseup()}else{a.untouchmove();a.untouchstart();a.untouchend()}if(typeof c!="object"){console.log("s:非法数据");return s._errImage(a)}else{for(var b in c){return true}console.log("s:无数据");return s._errImage(a)}},drawLine:function(b,N,C,J,A){var c=Snap(b);var m=s._getParam(A,"vw",$(b).width()),p=s._getParam(A,"vh",$(b).height());var M=s._getParam(A,"tt",0),d=s._getParam(A,"tb",30);var t=s._getParam(A,"ct",2*(d-M)+M+10),y=p-23,v=10,u=m-10;var D,B,e=5;var G=s._getParam(A,"isHome",false);var z=s._getParam(A,"isfull",false);var E;var I;var L;i();function i(){if(!s._init(c,N)){return false}if(typeof J!="function"){J=function(){}}E=C.length==2;if(E){I=N.k1.length>N.k2.length?N.k1:N.k2}else{I=N}if(I.length>1){B=(u-v)/(I.length-1)}else{B=u-v}F()}function F(){var P=0;$.each(N,function(R,Q){if(E){$.each(Q,function(T,S){P=q(S.price,P)})}else{P=q(Q.price,P)}});if(!P){return s._errImage(c)}D=s._getPerV(P,e);chartSuccess(b,"line");g();r();x()}function q(Q,P){var R=parseFloat(Q);return R>P?R:P}function x(){if(s.isPc){c.mousemove(function(Q){var P=Q.clientX+$(document).scrollLeft()-$(c.node).offset().left;k(P)});$(c.node).mouseleave(function(){l()})}else{c.touchstart(function(Q){var P=Q.touches[0].clientX;L=setTimeout(function(){k(P);c.touchmove(function(S){S.preventDefault();var R=S.touches[0].clientX;k(R)})},100);c.touchmove(function(R){clearTimeout(L)})});c.touchend(function(){c.untouchmove();l();clearTimeout(L)})}}function k(P){var Q=f(P);var R=$(".svglinetip").attr("svglineid");if(R!=Q){$(".svglinetip").remove();$(".svglinemaker").hide();j(Q)}}function l(){$(".svglinetip").remove();$(".svglinemaker").show();J()}function h(S,Y,R){var ab=S*B+v;var aa=o(Y.price);if(!R){var V=c.line(ab,y,ab,d).attr({stroke:G?"#6ba8e1":"#d2d2d2",strokeWidth:2.5})}var Q=c.circle(ab,aa,3).attr({stroke:G?"#fff":R?"#f5a25c":"#2484ce",strokeWidth:2,fill:G?"#47a8ef":"#fff"});var U=c.paper.rect(ab,R?d+1:M,100,d-M,4).attr({fill:G?"#fff":R?"#f5a25c":"#47a8ef"});var Z=c.paper.text(ab,R?2*d-M-(d-M-14)/2:d-(d-M-14)/2,[Y.name+":　","￥",s._formatMoney(Y.price)+"　",Y.num,"笔"]).attr({fill:G?"#2484ce":"#fff",fontSize:14});Z.select("tspan:nth-child(2)").attr({fontSize:G?12:10});Z.select("tspan:nth-child(5)").attr({fontSize:G?12:10});var P=Z.getBBox().width;var T=P+20;var X=ab-T/2;if(X<0){X=0}else{if(X>m-T){X=m-T}}U.attr({width:T,x:X});Z.attr({x:(T-P)/2+X});var W=c.paper.g();if(!R){W.add(V)}W.add(Q,U,Z);W.attr("class","svglinetip");W.attr("svglineid",S)}function H(P){if(N.k1[P]!=undefined){h(P,N.k1[P])}if(N.k2[P]!=undefined){h(P,N.k2[P],true)}}function j(P){if(E){J([N.k1[P],N.k2[P]]);H(P)}else{J(N[P]);h(P,N[P])}}function f(Q){var P=(Q/$(c.node).width())*m;if(P<=v){P=v}if(P>=u){P=u-1}var R=Math.floor((P-v)/B);if((P-v)%B>B/2&&I.length!=1){R++}return R}function r(){var P="M"+v+" "+y;var X="M"+v+" "+y;var W;var R;if(!E){var V=c.circle(2,2,1.2).attr({stroke:G?"#ffffff":"#2484ce",strokeWidth:1,fill:G?"#2484ce":"#ffffff","class":"svglinemaker"});var Y=V.marker(0,0,4,4,2,2);W="M"+v+" "+o(N[0].price);if(I.length==1){W+="L"+(B+v)+" "+o(N[0].price);P+="L"+(B+v)+" "+y}}else{W="M"+v+" "+o(N.k1[0].price);R="M"+v+" "+o(N.k2[0].price)}for(var U=1;U<I.length;U++){if(E){if(N.k1[U]!=undefined){W+="L"+(B*U+v)+" "+o(N.k1[U].price);P+="L"+(B*U+v)+" "+y}if(N.k2[U]!=undefined){R+="L"+(B*U+v)+" "+o(N.k2[U].price);X+="L"+(B*U+v)+" "+y}}else{if(N[U]!=undefined){W+="L"+(B*U+v)+" "+o(N[U].price);P+="L"+(B*U+v)+" "+y}}}O(P,W);var Q=c.path(P).attr({stroke:G?"#fffbcb":"#47a8ef",strokeWidth:2.5,fill:"none",strokeLinejoin:"bevel",markerEnd:Y});if(E){var T=c.path(X).attr({stroke:G?"#ffffff":"#f5a25c",strokeWidth:2.5,fill:"none",strokeLinejoin:"bevel"})}var S=c.g().attr({"class":"svglinemaker"});Q.animate({path:W},800,mina.easeinout,function(){if(!E){K(S)}});if(E){T.animate({path:R},800,mina.easeinout)}}function K(P){var U=N[N.length-1].price;var R=parseFloat(N[N.length-1].price);var S=R>(D*e)/1.3?24:-18;var Q=c.rect(m,o(U)+S-13,0,17,10,10).attr({fill:G?"#ffffff":"#89c058"});var T=c.text(m,o(U)+S,["￥",s._formatMoney(U)]).attr({fill:G?"#2f81d6":"#ffffff",fontSize:12});T.select("tspan").attr("font-size","11");Q.attr({x:u-T.getBBox().width-5,width:T.getBBox().width+10});T.attr({x:u-T.getBBox().width});P.add(Q,T)}function O(Q,S){var P=Q+"V"+y+"H"+v;var T=S+"V"+y+"H"+v;var R=c.path(P).attr({stroke:"none",fill:G?c.paper.gradient("l(0, 0, 0,1 )#ffffff-#2884D3"):"#47a8ef",fillOpacity:G?"0.3":"0.1",strokeLinejoin:"bevel",strokeLinecap:"round"});R.animate({path:T},800,mina.easeinout)}function w(){var P=(y-t)/e;var Q=c.line(v,y,u,y).attr({stroke:G?"#519ddb":"#e2e2e2",strokeDasharray:"10 2",strokeWidth:0.5});for(var R=1;R<=e;R++){var S=y-R*P;Q.clone().attr({x1:v,y1:S,x2:u,y2:S});c.text(v,S+13,s._formatMoney(D*R)).attr({fill:G?"#7abfe9":s.fontColor,fontSize:10})}}function a(){var P=c.paper.g().attr({fill:G?"#7abfe9":s.fontColor,fontSize:10});var Q=E?N.k1:N;if(!Q.length){console.log("s:k1无数据,画不出底部刻度");
    return false}var aa=Q[0].name.indexOf("~")+1;var ad=n();if(aa!=0&&ad.length>4&&m<660){var ac=c.text(0,y+12,Q[0].name.substr(0,aa));var ab=c.text(0,y+22,Q[0].name.substr(aa));var V=c.text(m,y+12,Q[Q.length-1].name.substr(0,aa));var T=c.text(m,y+22,Q[Q.length-1].name.substr(aa));P.add(ac,V,ab,T);V.attr({x:m-V.getBBox().width});T.attr({x:m-V.getBBox().width});for(var Y=1;Y<ad.length-1;Y++){var S=c.text(B*ad[Y]+v,y+12,Q[ad[Y]].name.substr(0,aa));var R=c.text(B*ad[Y]+v,y+22,Q[ad[Y]].name.substr(aa));S.attr({x:B*ad[Y]+v-S.getBBox().width/2});R.attr({x:B*ad[Y]+v-S.getBBox().width/2});P.add(S,R)}}else{var U=c.text(0,y+12,Q[0].name);var X=c.text(m,y+12,Q[Q.length-1].name);P.add(U,X);X.attr({x:m-X.getBBox().width});for(var W=1;W<ad.length-1;W++){var Z=c.text(B*ad[W]+v,y+12,Q[ad[W]].name);Z.attr({x:B*ad[W]+v-Z.getBBox().width/2});P.add(Z)}}}function g(){w();a()}function n(){var P=[];var Q=I.length-1;var U;var T;if(!Q||!(Q-1)){T=1}else{if(!(Q%5)){T=5}else{if(!(Q%4)){T=4}else{if(!(Q%3)){T=3}else{if(!((Q-1)%5)){T=5}else{if(!((Q-1)%4)){T=4}else{if(!((Q-1)%3)){T=3}else{if(!(Q%2)){T=2}else{if(!((Q-1)%2)){T=2}else{console.log("s:均分日期未成功");return s._err(c,"数据异常")}}}}}}}}}U=Math.floor(Q/T);for(var R=0;R<T;R++){P.push(U*R)}var S=U*T;if((Q%T)){S++}P.push(S);return P}function o(P){if(P){P=parseFloat(P);return y-(P/(D*e))*(y-t)}return y}},drawBar:function(a,Q,D,L,C){var b=Snap(a);var x,O=0,M;var i=s._getParam(C,"vw",$(a).width()),l=s._getParam(C,"vh",$(a).height());var P=s._getParam(C,"tt",0),c=s._getParam(C,"tb",30);var n=s._getParam(C,"ct",2*(c-P)+P+10),y=l-18,r=10,o=i-20;var E,B,d=i<400?5:6;var F,A;var t=0,R=0,J;var v;var z=s._getParam(C,"isfull",false);var K;var N;g();function g(){if(!s._init(b,Q)){return false}if(typeof L!="function"){L=function(){}}F=D.length==2?true:false;A=Q[0].item!=undefined?true:false;B=F?37:26;G()}function G(){var Y=0;var S=0;for(var V=0;V<Q.length;V++){if(Y>=100){Q.splice(V,Q.length-V);break}if(A){for(var U=0;U<Q[V].item.length;U++){var W=Q[V].item[U];var T=m(W,S);if(T){S=T;if(O<84){var X=(W.name.toString().length+1)*13+6>84?84:(W.name.toString().length+1)*13+6;O=O<X?X:O}}else{Q[V].item.splice(U,1);U--}Y++}if(!Q[V].item.length){Q.splice(V,1);V--}}else{var T=m(Q[V],S);if(T){S=T;if(O<84){var X=Q[V].name.toString().length*13+6>84?84:Q[V].name.toString().length*13+6;O=O<X?X:O}}else{Q.splice(V,1);V--}Y++}}if(!Q.length){console.log("s:"+Y+"条数据price全是0");return s._errImage(b)}E=s._getPerV(S,d);chartSuccess(a,"bar");e();H();w()}function m(T,S){var U;if(F){if(parseFloat(T.k1.price)==0&&parseFloat(T.k2.price)==0){return false}U=parseFloat(T.k1.price)>S?parseFloat(T.k1.price):S;U=parseFloat(T.k2.price)>U?parseFloat(T.k2.price):U;return U}else{if(parseFloat(T.price)==0){return false}U=parseFloat(T.price)>S?parseFloat(T.price):S;return U}}function f(Y,aa,ai){if(aa){var ab=Y*B+B/2+n+t;var ac;if(!F){ac=j(aa.price)+O+8}else{if(parseFloat(aa.price)>parseFloat(ai.price)){ac=j(aa.price)+O+8}else{ac=j(ai.price)+O+8}}var V=b.line(ac,ab,ac,c).attr({stroke:"#d2d2d2",strokeWidth:2.5});var W=b.circle(ac,ab,3).attr({stroke:"#47a8ef",strokeWidth:3,fill:"#fff"});var T=b.paper.rect(ac,P,100,c-P,4).attr({fill:"#47a8ef"});var ad=b.paper.text(ac,c-(c-P-14)/2,[D[0]+":　","￥",s._formatMoney(aa.price)+"　",aa.num,"笔"]).attr({fill:"#fff",fontSize:14});ad.select("tspan:nth-child(2)").attr({fontSize:8});ad.select("tspan:nth-child(5)").attr({fontSize:8});var aj=ad.getBBox().width;var U=aj+20;var X=ac-U/2;if(X<0){X=0}else{if(X>i-U){X=i-U}}T.attr({width:U,x:X});ad.attr({x:(U-aj)/2+X});var ae=b.paper.g();ae.attr("class","svgbartip");ae.attr("svgbartipid",Y);ae.add(T,ad,V,W);if(ai){var af=b.paper.rect(ac,c+1,100,c-P,4).attr({fill:"#f5a25c"});var Z=b.paper.text(ac,2*c-P-(c-P-14)/2,[D[1]+":　","￥",s._formatMoney(ai.price)+"　",ai.num,"笔"]).attr({fill:"#fff",fontSize:14});Z.select("tspan:nth-child(2)").attr({fontSize:8});Z.select("tspan:nth-child(5)").attr({fontSize:8});var S=Z.getBBox().width;var ah=S+20;var ag=ac-ah/2;if(ag<0){ag=0}else{if(ag>i-ah){ag=i-ah}}af.attr({width:ah,x:ag});Z.attr({x:(ah-S)/2+ag});ae.add(af,Z)}}else{console.log("s:点击到了bar之外的区域")}}function h(S){if(A){var T=s._getLayer(S,Q);if(F){f(S,Q[T.parent].item[T.child].k1,Q[T.parent].item[T.child].k2)}else{f(S,Q[T.parent].item[T.child])}L(Q[T.parent].item[T.child]);if(z){u(Q[T.parent].item[T.child].name)}}else{if(F){f(S,Q[S].k1,Q[S].k2)}else{f(S,Q[S])}L(Q[S]);if(z){u(Q[S].name)}}}function u(S){var T=b.text(0,P-8,S).attr({"class":"svgbartip",fill:"#1978bc",fontSize:18});T.attr("x",i/2-T.getBBox().width/2)}function k(){$(".svgbartip").remove();L()}function p(S,T){R=t+S-J;if(R>0){R=0}else{if(R<-B*(M+1)+(y-n)){R=y-n<B*(M+1)?-B*(M+1)+(y-n):0}}v.transform("translate(0,"+R+")")}function w(){if(s.isPc){b.mousedown(function(S){J=S.clientY+$(document).scrollTop()-$(b.node).offset().top;J=J/1.4;if(J>n&&J<y){N=setTimeout(function(){var T=J-n-t;var U=Math.floor(T/B);if(U>=0&&U<M){h(U)}},100);b.mousemove(function(T){var U=T.clientY+$(document).scrollTop()-$(b.node).offset().top;U=U/1.4;if(U-J!=0){k();
    clearTimeout(N)}p(U,T)})}});b.mouseup(function(S){b.unmousemove();k();clearTimeout(N);t=R});$(a).mouseleave(function(){b.unmousemove()})}else{b.touchstart(function(T){J=T.touches[0].clientY;var S=J+$(document).scrollTop()-b.node.offsetTop;if(S>n&&S<y){N=setTimeout(function(){b.untouchmove();var U=S-n-t;var V=Math.floor(U/B);if(V>=0&&V<M){h(V)}b.touchmove(function(Z){Z.preventDefault();J=Z.touches[0].clientY;var Y=J+$(document).scrollTop()-b.node.offsetTop;if(Y>n&&Y<y){var W=Y-n-t;var X=Math.floor(W/B);var aa=$(".svgbartip").attr("svgbartipid");if(X>=0&&X<M&&aa!=X){k();h(X)}}})},100);b.touchmove(function(U){clearTimeout(N);if(z){U.preventDefault();var V=U.touches[0].clientY;p(V,U)}})}});b.touchend(function(S){b.untouchmove();k();clearTimeout(N);t=R})}}function e(){var T=(o-O)/d;for(var U=0;U<=d;U++){var S=O+U*T;b.line(S,y,S,n).attr({stroke:"#e2e2e2",strokeDasharray:"10 2",strokeWidth:0.5});var V=b.text(S,l-4,s._formatMoney(E*U)).attr({fill:s.fontColor,fontSize:10});V.attr("x",S-V.getBBox().width/2)}}function I(T,U,V){if(U){var X=x.text(O,F?M*B+24:M*B+16,A?s._formatName(U,5):s._formatName(U,6)).attr({fill:s.fontColor,fontSize:12});X.attr("x",O-X.getBBox().width-4);v.add(X)}var S;if(V%2&&!A){S="#88bf57"}else{S="#7cb7ef"}var W=x.rect(O,U?M*B+8:M*B+B/2+1,j(T),10).attr({fill:U?S:"#f5a25c"});v.add(W)}function q(S,T){I(S.k1.price,S.name,T);I(S.k2.price,false,T)}function H(){x=b.svg(0,n,i,y-n);v=x.g();M=0;for(var V=0;V<Q.length;V++){var W=Q[V];if(A){var T=0;$.each(W.item,function(Y,X){if(F){q(X,V)}else{I(X.price,X.name,V)}T++;M++});if(T>1){var U=x.text(r,(M-T)*B+T*B/2+6,T>2?s._formatName(W.name,5):s._formatName(W.name,4)).attr({fill:s.fontColor,fontSize:10});U.attr({x:r-U.getBBox().width/2});U.transform("roate(-90)");v.add(U)}var S=x.line(r,M*B,O-4,M*B).attr({stroke:s.fontColor,strokeDasharray:"5 2",strokeWidth:1});v.add(S)}else{if(F){q(W)}else{I(W.price,W.name)}M++}}}function j(S){if(!S){return 0}return(parseFloat(S)/(d*E))*(o-O)}},drawColumn:function(a,P,H,L,F){var b=Snap(a);var A,o,v;var k=s._getParam(F,"vw",$(a).width()),q=s._getParam(F,"vh",$(a).height());var O=s._getParam(F,"tt",0),e=s._getParam(F,"tb",30);var t=s._getParam(F,"ct",2*(e-O)+O+10),B,w=10,u=k;var I,G,f=5;var y=0,Q=0,M;var l;var C=s._getParam(F,"isfull",false);var J,E;var N;i();function i(){if(!s._init(b,P)){return false}if(typeof L!="function"){L=function(){}}J=H.length==2?true:false;E=P[0].item!=undefined?true:false;G=J?53:42;B=E?q-37:q-25;K()}function K(){var W=0;var R=0;for(var U=0;U<P.length;U++){if(W>=100){P.splice(U,P.length-U);break}if(E){for(var T=0;T<P[U].item.length;T++){var V=P[U].item[T];var S=r(V,R);if(S){R=S}else{P[U].item.splice(T,1);T--}W++}if(!P[U].item.length){P.splice(U,1);U--}}else{var S=r(P[U],R);if(S){R=S}else{P.splice(U,1);U--}W++}}if(!P.length){console.log("s:"+W+"条数据price全是0");return s._errImage(b)}I=s._getPerV(R,f);chartSuccess(a,"column");g();c();z()}function r(S,R){var T;if(J){if(parseFloat(S.k1.price)==0&&parseFloat(S.k2.price)==0){return false}T=parseFloat(S.k1.price)>R?parseFloat(S.k1.price):R;T=parseFloat(S.k2.price)>T?parseFloat(S.k2.price):T;return T}else{if(parseFloat(S.price)==0){return false}T=parseFloat(S.price)>R?parseFloat(S.price):R;return T}}function h(X,Z,ah){if(Z){var ab=X*G+G/2+o+y;var aa;if(!J){aa=n(Z.price)+t-8}else{if(parseFloat(Z.price)>parseFloat(ah.price)){aa=n(Z.price)+t-8}else{aa=n(ah.price)+t-8}}var U=b.line(ab,aa,ab,e).attr({stroke:"#d2d2d2",strokeWidth:2.5});var V=b.circle(ab,aa,3).attr({stroke:"#47a8ef",strokeWidth:3,fill:"#fff"});var S=b.paper.rect(ab,O,100,e-O,4).attr({fill:"#47a8ef"});var ac=b.paper.text(ab,e-(e-O-14)/2,[H[0]+":　","￥",s._formatMoney(Z.price)+"　",Z.num,"笔"]).attr({fill:"#fff",fontSize:14});ac.select("tspan:nth-child(2)").attr({fontSize:8});ac.select("tspan:nth-child(5)").attr({fontSize:8});var ai=ac.getBBox().width;var T=ai+20;var W=ab-T/2;if(W<0){W=0}else{if(W>k-T){W=k-T}}S.attr({width:T,x:W});ac.attr({x:(T-ai)/2+W});var ad=b.paper.g();ad.attr("class","svgcolumntip");ad.attr("svgcolumntipid",X);ad.add(S,ac,U,V);if(ah){var ae=b.paper.rect(ab,e+1,100,e-O,4).attr({fill:"#f5a25c"});var Y=b.paper.text(ab,2*e-O-(e-O-14)/2,[H[1]+":　","￥",s._formatMoney(ah.price)+"　",ah.num,"笔"]).attr({fill:"#fff",fontSize:14});Y.select("tspan:nth-child(2)").attr({fontSize:8});Y.select("tspan:nth-child(5)").attr({fontSize:8});var R=Y.getBBox().width;var ag=R+20;var af=ab-ag/2;if(af<0){af=0}else{if(af>k-ag){af=k-ag}}ae.attr({width:ag,x:af});Y.attr({x:(ag-R)/2+af});ad.add(ae,Y)}}else{console.log("点击到了bar之外的区域")}}function j(R){if(E){var S=s._getLayer(R,P);if(S){if(J){h(R,P[S.parent].item[S.child].k1,P[S.parent].item[S.child].k2)}else{h(R,P[S.parent].item[S.child])}L(P[S.parent].item[S.child]);if(C){x(P[S.parent].item[S.child].name)}}}else{if(J){h(R,P[R].k1,P[R].k2)}else{h(R,P[R])}L(P[R]);if(C){x(P[R].name)}}}function p(){$(".svgcolumntip").remove();L()}function x(R){var S=b.text(0,O-8,R).attr({"class":"svgcolumntip",fill:"#1978bc",fontSize:18});S.attr("x",k/2-S.getBBox().width/2)}function D(R,S){Q=y+R-M;
    if(Q>0){Q=0}else{if(Q<-G*(v+1)+k-o){Q=k-o<G*(v+1)?-G*(v+1)+k-o:0}}l.transform("translate("+Q+",0)")}function z(){if(s.isPc){b.mousedown(function(R){b.unmousemove();M=R.clientX+$(document).scrollLeft()-$(b.node).offset().left;M=(M/$(b.node).width())*k;b.mousemove(function(T){var S=T.clientX+$(document).scrollLeft()-$(b.node).offset().left;S=(S/$(b.node).width())*k;if(S-M!=0){p();clearTimeout(N)}D(S,T)});b.mouseup(function(S){b.unmousemove();b.mousemove(function(V){var T=V.clientX+$(document).scrollLeft()-$(b.node).offset().left;T=(T/$(b.node).width())*k;T=T-o-y;var U=Math.floor(T/G);var W=$(".svgcolumntip").attr("svgcolumntipid");if(U>=0&&U<v&&W!=U){p();j(U)}});y=Q})});b.mousemove(function(T){var R=T.clientX+$(document).scrollLeft()-$(b.node).offset().left;R=(R/$(b.node).width())*k;R=R-o-y;var S=Math.floor(R/G);var U=$(".svgcolumntip").attr("svgcolumntipid");if(S>=0&&S<v&&U!=S){p();j(S)}});$(a).mouseleave(function(){p()})}else{b.touchstart(function(R){M=R.touches[0].clientX;if(C){M=(M/$(b.node).width())*k}N=setTimeout(function(){b.untouchmove();var S=M-o-y;var T=Math.floor(S/G);if(T>=0&&T<v){j(T)}b.touchmove(function(W){W.preventDefault();M=W.touches[0].clientX;if(C){M=(M/$(b.node).width())*k}var U=M-o-y;var V=Math.floor(U/G);var X=$(".svgcolumntip").attr("svgcolumntipid");if(V>=0&&V<v&&X!=V){p();j(V)}})},100);b.touchmove(function(T){T.preventDefault();clearTimeout(N);var S=T.touches[0].clientX;if(C){S=(S/$(b.node).width())*k}D(S,T)})});b.touchend(function(R){b.untouchmove();p();clearTimeout(N);y=Q})}}function g(){o=0;var R=(B-t)/f;var S=b.line(w,B,u,B).attr({stroke:"#e2e2e2",strokeDasharray:"10 2",strokeWidth:0.5});for(var T=1;T<=f;T++){var U=B-T*R;S.clone().attr({x1:w,y1:U,x2:u,y2:U});var V=b.text(w,U+15,s._formatMoney(I*T)).attr({fill:s.fontColor,fontSize:12});o=V.getBBox().width+w+10>o?V.getBBox().width+w+10:o}}function n(R){if(!R){R=0}R=parseFloat(R);return B-t-(R/(I*f))*(B-t)}function m(aa,R){var Z=G*v;var W=n(aa);var Y=A.rect(R?Z+16:Z+28,W,10,B-t-W).attr({fill:R?"#7cb7ef":"#f5a25c"});l.add(Y);if(R){R=R.toString();var X=J?8:6;if(R.length>X){R=s._formatName(R,X)}if(R.length>X/2){var V=R.substr(0,X/2);var U=R.substr(X/2);var T=A.text(Z,B-t+11,V).attr({fill:s.fontColor,fontSize:10});var S=A.text(Z,B-t+22,U).attr({fill:s.fontColor,fontSize:10});T.attr("x",Z+(G-T.getBBox().width)/2);S.attr("x",Z+(G-T.getBBox().width)/2);l.add(T,S)}else{var ab=A.text(Z,B-t+11,R).attr({fill:s.fontColor,fontSize:10});ab.attr("x",Z+(G-ab.getBBox().width)/2);l.add(ab)}}}function d(R,S){m(R.k1.price,R.name,S);m(R.k2.price,false,S)}function c(){A=b.svg(o,t,k-o,q-t);l=A.g();v=0;for(var T=0;T<P.length;T++){if(E){var S=0;$.each(P[T].item,function(V,W){if(J){d(W,T)}else{m(W.price,W.name,T)}v++;S++});if(S>1){var U=A.text(v*G,q-t-2,s._formatName(P[T].name,6)).attr({fill:s.fontColor,fontSize:10});U.attr({x:(v-S)*G+(S*G-U.getBBox().width)/2});l.add(U)}var R=A.line(v*G,B-t+2,v*G,q-t-1).attr({stroke:s.fontColor,strokeDasharray:"5 2",strokeWidth:1});l.add(R)}else{if(J){d(P[T])}else{m(P[T].price,P[T].name)}v++}}}},drawPie:function(y,D,b,A,n){var r=Snap(y);var u=s._getParam(n,"vw",$(y).width()),C=s._getParam(n,"vh",$(y).height());var a=s._getParam(n,"tt",0),k=s._getParam(n,"tb",35);var j=s._getParam(n,"ct",k+30),t=s._getParam(n,"cb",C-10);var q=s._getParam(n,"px",u/3),v=(t-j)/2<q*0.8?(t-j)/2:q*0.8,p=j+v;var w=["#F27254","#FFBE32","#A1BB38","#5BC45E","#51B4D4","#576ACD","#A66CE2","#FF74E0"];var d=0;var i=s._getParam(n,"isfull",false);var o=3;f();function f(){if(!s._init(r,D)){return false}if(typeof A!="function"){A=function(){}}B()}function h(){if(s.isPc){r.mousedown(function(){$(".svgpiepie").attr("transform","");m();A()})}else{r.touchstart(function(){$(".svgpiepie").attr("transform","");m();A()})}}function B(){var E={};E.price=0;E.num=0;for(var F=0;F<D.length;F++){var H=parseFloat(D[F].price);if(i){var G=D[F].name.toString();if(G.length>5){o=2}}if(!H){if(F==0){console.log("s:第一个数据price为0");return s._errImage(r)}D.splice(F,D.length-F);break}d+=H;if(F+1>8){E.price+=H;E.name="其他";E.num+=parseFloat(D[F].num)}}if(E.name){E.price+=parseFloat(D[7].price);E.num+=parseFloat(D[7].num);D.splice(7,D.length-7,E)}chartSuccess(y,"pie");if(D[0].price==d){g()}else{z()}h()}function z(){var F=0;var G=[],E=[];G[0]=q-v;E[0]=p;$.each(D,function(M,R){var N=R.price/d;var O=N>0.5?1:0;F+=N;G[M+1]=q-v*Math.cos(2*Math.PI*F);E[M+1]=p-v*Math.sin(2*Math.PI*F);var T=F-N/2;var Q=q-10*Math.cos(2*Math.PI*T)-q;var P=p-10*Math.sin(2*Math.PI*T)-p;var K="M "+q+" "+p+"L "+G[M]+" "+E[M]+" "+"A "+v+" "+v+" "+0+" "+O+" "+1+" "+G[M+1]+" "+E[M+1]+" "+" Z";var L=r.g().attr({"class":"svgpiepie"});var J=Math.floor(Math.random()*w.length);var U=r.path(K).attr({fill:w[J],stroke:"#fff",strokeWidth:"1"});L.add(U);if(N>1/14){var I=q-v*Math.cos(2*Math.PI*T)/1.4-18;var H=p-v*Math.sin(2*Math.PI*T)/1.4;var S=r.text(I,H,Math.round(R.price*1000/d)/10+"%").attr({fill:"#fff",fontSize:12});L.add(S)}if(s.isPc){L.mousedown(function(V){x(this,Q,P,R,V)})}else{L.touchstart(function(V){x(this,Q,P,R,V)})}e(w[J],M,R,L,Q,P);
    w.splice(J,1)})}function e(E,F,N,G,M,L){if(i){var P=Math.floor(F/o);var J=F%o;var I=r.rect(u/10+J*(u*0.8)/o,t+30+P*30,5,5).attr({fill:E});var O=r.text(u/10+J*(u*0.8)/o+10,t+38+P*30,s._formatName(N.name,o==3?5:8)).attr({fontSize:14})}else{var H=j+F*(t-j)/8+9;var I=r.rect(u*2/3,H,5,5).attr({fill:E});var O=r.text(u*2/3+10,H+7,s.isPc?N.name:s._formatName(N.name,6)).attr({fontSize:14})}var K=r.g();K.add(I,O);if(s.isPc){K.mousedown(function(Q){x(G,M,L,N,Q)})}else{K.touchstart(function(Q){x(G,M,L,N,Q)})}}function g(){var E=Math.floor(Math.random()*8);var F=r.circle(q,p,v).attr({fill:w[E]});if(s.isPc){F.mousedown(function(G){G.stopPropagation();F.attr("hasTip","1");l(w[E],D[0]);A(D[0])}).mouseup(function(){F.attr("hasTip","0");m();A()})}else{F.touchstart(function(G){G.stopPropagation();F.attr("hasTip","1");l(w[E],D[0]);if(i){c(D[0].name)}A(D[0])}).touchend(function(){F.attr("hasTip","0");m();A()})}r.text(q-12,p,"100%").attr({fill:"#fff",fontSize:12});e(w[E],0,D[0],F)}function x(E,I,H,G,J){if(I){if(!E.transform().string){var F=E.select("path").attr("fill");J.stopPropagation();if(s.isPc){$(".svgpiepie").removeAttr("transform");$(E.node).attr({"transform":"translate("+I+","+H+")"})}else{$(".svgpiepie").attr("transform","");E.animate({transform:"translate("+I+","+H+")"},300,mina.easein)}l(F,G);if(i){c(G.name)}A(G)}}else{var F=E.attr("fill");if(E.attr("hasTip")==1){E.attr({hasTip:"0"})}else{J.stopPropagation();E.attr({hasTip:"1"});l(F,G);if(i){c(G.name)}A(G)}}}function c(E){var F=r.text(0,a-17,E).attr({"class":"svgpietip",fill:"#1978bc",fontSize:18});F.attr("x",u/2-F.getBBox().width/2)}function l(F,E){$(".svgpietip").remove();var G=r.rect(u/2,a,0,k-a,3).attr({fill:F,"class":"svgpietip"});var H=r.text(u/2,k-((k-a)-10)/2,[b[0]+":　","￥",s._formatMoney(E.price)+"　",E.num,"笔"]).attr({fill:"#fff","class":"svgpietip",fontSize:14});G.attr({width:H.getBBox().width+20,x:u/2-(H.getBBox().width+20)/2});H.attr({x:u/2-H.getBBox().width/2})}function m(){$(".svgpietip").remove()}},drawPcColumn:function(e,d,c,a){s.fontColor="#333333";s.isPc=true;var b=s._pcScreen(e);s.drawColumn(e,d,c,a,b)},drawPcLine:function(e,d,c,a){s.fontColor="#333333";s.isPc=true;var b=s._pcScreen(e);s.drawLine(e,d,c,a,b)},drawPcBar:function(e,d,c,a){s.fontColor="#333333";s.isPc=true;var b=s._pcScreen(e);s.drawBar(e,d,c,a,b)},drawPcPie:function(d,c,b,a){s.fontColor="#333333";s.isPc=true;$(d).removeAttr("viewBox");s.drawPie(d,c,b,a)},drawFullColumn:function(a,d,i,g){var j=s._fullScreen(a,340);var h=j.width;var c=j.height;var b=55;var f=30;var e={tb:b,tt:f,ct:2*(b-f)+f+3,vw:h,vh:c,isfull:true};s.drawColumn(a,d,i,g,e)},drawFullLine:function(a,d,i,g){var j=s._fullScreen(a,300);var h=j.width;var c=j.height;var b=40;var f=10;var e={tb:b,tt:f,ct:2*(b-f)+f+3,vw:h,vh:c,isfull:true};s.drawLine(a,d,i,g,e)},drawFullBar:function(g,f,d,a){var b=s._fullScreen(g);var e=b.width;var h=b.height;var c={vw:e,vh:h-80,tt:30,tb:60,isfull:true};s.drawBar(g,f,d,a,c)},drawFullPie:function(b,d,h,f){var i=s._fullScreen(b);var g=i.width;var c=i.height;var a=c-220;var e={cb:a,tb:85,tt:50,px:g/2,vw:g,vh:c,isfull:true};s.drawPie(b,d,h,f,e)},drawHomeLine:function(e,d,c,a){s.isHome=true;var b={isHome:true,tt:20,tb:55,ct:70};s.drawLine(e,d,c,a,b)},_err:function(a,c){var b=a.text($(a.node).width()/2,$(a.node).height()/2+20,c).attr({fontSize:24});b.attr({x:$(a.node).width()/2-b.getBBox().width/2});return false},_errImage:function(b){var d,f;if(b.attr("viewBox")){d=b.attr("viewBox").width;f=b.attr("viewBox").height}else{d=$(b.node).width();f=$(b.node).height()}var a=b.paper.image(svgnodataurl,10,10,168,90);a.attr({x:d/2-a.getBBox().width/2,y:f/2-a.getBBox().height/2});var e=b.text(d/2,a.getBBox().y2+24,"暂无经营数据").attr({fontSize:16,fill:s.isHome?"#67b7ed":"#bbbbbb"});var c=b.text(d/2,a.getBBox().y2+46,"赶快使用订单系统，公司经营各项数据轻松在手！").attr({fontSize:14,fill:s.isHome?"#67b7ed":"#bbbbbb"});e.attr({x:d/2-e.getBBox().width/2});c.attr({x:d/2-c.getBBox().width/2});return false},_formatName:function(b,a){return b.substr(0,a)},_getParam:function(b,a,c){if(b){return b[a]!=undefined?b[a]:c}else{return c}},_fullScreen:function(d,a){var c=Snap(d);c.attr("height","100%");var b={};if(!a){b.width=$(window).width();b.height=$(window).height()}else{b.height=a;b.width=b.height*$(window).width()/$(window).height()}c.attr("viewBox","0 0 "+b.width+" "+b.height);return b},_pcScreen:function(e){var b=Snap(e);var a={};a.height=$(e).height()/1.4;a.width=$(e).width()/1.4;b.attr("viewBox","0 0 "+a.width+" "+a.height);var d=a.width;var f=a.height;var c={vw:d,vh:f};return c},_getPerV:function(a,b){if(a==0){return 1}var c=a/b;var d;if(c>10000){d=5000}else{if(c>5000){d=1000}else{if(c>2000){d=500}else{if(c>500){d=100}else{if(c>100){d=20}else{if(c>b){d=10}else{d=1}}}}}}return Math.ceil(c/d)*d},_getLayer:function(b,e){var d=0;var f=0;var a=0;for(var c=0;c<e.length;c++){if(b<e[c].item.length+a){d=c;f=b-a;return{parent:d,child:f}}else{a=e[c].item.length+a}}return false},_formatNumber:function(a){var b;if(a>=100000){if(a>=100000000){if(a>=10000000000){b=Math.round(a/100000000);
    return[b.toString(),"亿"]}b=Math.round(a/10000000);return[b.toString().slice(0,-1),"亿",b.toString().slice(-1)]}if(a>=1000000){b=Math.round(a/10000);return[b.toString(),"万"]}b=Math.round(a/1000);return[b.toString().slice(0,-1),"万",b.toString().slice(-1)]}return[a.toString()]},_formatMoney:function(a){var d=s._formatNumber(parseInt(a));var c;if(d[0].length>3){for(var b=3;b<d[0].length;b+=4){c=d[0].slice(0,-b)+","+d[0].slice(-b)}}else{c=d[0]}if(d[2]){c+="."+d[2]}if(d[1]){c+=d[1]}return c}};